<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Winamp - Pro Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --accent: #00f2ff;
            --bg-main: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.7);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.1);
            --active-bg: rgba(0, 242, 255, 0.15);
        }

        * { box-sizing: border-box; }
        body {
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: var(--text-primary);
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 40px 20px;
            min-height: 100vh;
            margin: 0;
        }

        .window {
            width: 100%;
            max-width: 450px;
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .title-bar {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1.5px;
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--glass-border);
            text-transform: uppercase;
        }

        .player-content { padding: 25px; }

        .display-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        #time-display {
            font-size: 3rem;
            font-weight: 200;
            font-family: 'Courier New', monospace;
            color: var(--accent);
            text-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
            margin-bottom: 5px;
        }

        #current-title {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- CONTROLS --- */
        .main-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .mode-controls {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 30px;
            margin-bottom: 20px;
        }

        .ctrl-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .playback-btn {
            font-size: 1.2rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .playback-btn:hover { background: rgba(255, 255, 255, 0.1); color: var(--accent); }

        .play-pause-btn {
            font-size: 2.2rem;
            color: var(--accent);
            width: 60px;
            height: 60px;
            background: var(--active-bg);
        }

        .mode-btn {
            font-size: 0.9rem;
            color: var(--text-secondary);
            gap: 5px;
            padding: 5px 10px;
            border-radius: 15px;
        }

        .mode-btn.active {
            color: var(--accent);
            background: var(--active-bg);
            text-shadow: 0 0 8px var(--accent);
        }

        /* Sliders */
        .slider-box { width: 100%; margin: 15px 0; }
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px; height: 14px; background: var(--accent); border-radius: 50%; cursor: pointer;
        }

        /* Playlist */
        .playlist-area { height: 180px; overflow-y: auto; padding: 10px; }
        .playlist-item {
            display: flex; justify-content: space-between; padding: 12px 15px;
            border-radius: 8px; margin-bottom: 5px; cursor: pointer; font-size: 13px;
        }
        .playlist-item:hover { background: rgba(255,255,255,0.05); }
        .playlist-item.active { background: var(--active-bg); color: var(--accent); border-left: 3px solid var(--accent); }

        .footer-btns { padding: 15px 20px; display: flex; gap: 10px; border-top: 1px solid var(--glass-border); }
        .action-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            color: var(--text-primary); padding: 8px 15px; border-radius: 6px; font-size: 12px; cursor: pointer; flex: 1;
        }
        .action-btn:hover { background: var(--accent); color: var(--bg-main); }

        .eq-container { display: flex; justify-content: space-between; padding: 20px; height: 80px; align-items: flex-end; }
        .eq-bar { width: 6%; background: var(--accent); border-radius: 2px 2px 0 0; opacity: 0.6; }
    </style>
</head>
<body>

<div class="window">
    <div class="title-bar">
        <span><i class="fa-solid fa-compact-disc fa-spin"></i> Winamp Pro</span>
        <span><i class="fa-solid fa-minus"></i> <i class="fa-solid fa-xmark"></i></span>
    </div>
    <div class="player-content">
        <div class="mode-controls">
            <button class="ctrl-btn mode-btn" id="btn-shuffle" title="Shuffle (Random)">
                <i class="fa-solid fa-shuffle"></i>
            </button>
            <button class="ctrl-btn mode-btn" id="btn-repeat" title="Repeat Mode">
                <i class="fa-solid fa-repeat"></i> <span id="repeat-label">All</span>
            </button>
            <button class="ctrl-btn mode-btn" id="btn-loop" title="Loop Track">
                <i class="fa-solid fa-arrows-rotate"></i>
            </button>
        </div>

        <div class="display-section">
            <div id="time-display">00:00</div>
            <div id="current-title">Memuat...</div>
        </div>

        <div class="slider-box">
            <input type="range" id="seek-bar" value="0">
        </div>

        <div class="main-controls">
            <button class="ctrl-btn playback-btn" id="prev"><i class="fa-solid fa-backward-step"></i></button>
            <button class="ctrl-btn playback-btn play-pause-btn" id="play-toggle"><i class="fa-solid fa-play" id="play-icon"></i></button>
            <button class="ctrl-btn playback-btn" id="next"><i class="fa-solid fa-forward-step"></i></button>
        </div>

        <div class="main-controls" style="margin-top: 20px; gap: 10px;">
            <i class="fa-solid fa-volume-low" style="font-size: 12px; color: var(--text-secondary)"></i>
            <input type="range" id="volume-slider" value="80" style="width: 180px;">
            <i class="fa-solid fa-volume-high" style="font-size: 12px; color: var(--text-secondary)"></i>
        </div>
    </div>
</div>

<div class="window">
    <div class="eq-container" id="visualizer-bars"></div>
</div>

<div class="window">
    <div class="title-bar"><span>Playlist Editor</span> <span id="track-count">0 Lagu</span></div>
    <div class="playlist-area" id="playlist-box"></div>
    <div class="footer-btns">
        <button class="action-btn" onclick="document.getElementById('file-input').click()">+ ADD</button>
        <button class="action-btn" onclick="clearPlaylist()">CLEAR</button>
    </div>
</div>

<input type="file" id="file-input" multiple accept="audio/*" style="display:none">
<audio id="audio-engine"></audio>

<script>
    const audio = document.getElementById('audio-engine');
    const fileInput = document.getElementById('file-input');
    const playlistBox = document.getElementById('playlist-box');
    const currentTitle = document.getElementById('current-title');
    const timeDisplay = document.getElementById('time-display');
    const seekBar = document.getElementById('seek-bar');
    const volumeSlider = document.getElementById('volume-slider');
    const playIcon = document.getElementById('play-icon');
    
    // Mode States
    let playlist = [];
    let currentIndex = 0;
    let isShuffle = false;
    let repeatMode = 'all'; // 'none', 'all', 'one'

    // Init Visualizer
    const vizContainer = document.getElementById('visualizer-bars');
    for(let i=0; i<15; i++) {
        const bar = document.createElement('div');
        bar.className = 'eq-bar';
        bar.style.height = '10%';
        vizContainer.appendChild(bar);
    }

    // --- LOGIKA REPEAT & SHUFFLE ---
    const btnRepeat = document.getElementById('btn-repeat');
    const btnShuffle = document.getElementById('btn-shuffle');
    const btnLoop = document.getElementById('btn-loop');
    const repeatLabel = document.getElementById('repeat-label');

    btnRepeat.onclick = () => {
        if (repeatMode === 'all') {
            repeatMode = 'one';
            repeatLabel.innerText = "One";
            btnRepeat.classList.add('active');
        } else if (repeatMode === 'one') {
            repeatMode = 'none';
            repeatLabel.innerText = "None";
            btnRepeat.classList.remove('active');
        } else {
            repeatMode = 'all';
            repeatLabel.innerText = "All";
            btnRepeat.classList.add('active');
        }
    };

    btnShuffle.onclick = () => {
        isShuffle = !isShuffle;
        btnShuffle.classList.toggle('active', isShuffle);
    };

    btnLoop.onclick = () => {
        // Loop di sini kita buat sebagai pintasan untuk Repeat One
        repeatMode = (repeatMode === 'one') ? 'all' : 'one';
        repeatLabel.innerText = repeatMode.charAt(0).toUpperCase() + repeatMode.slice(1);
        btnRepeat.classList.toggle('active', repeatMode !== 'none');
        btnLoop.classList.toggle('active', repeatMode === 'one');
    };

    // --- CORE PLAYER ---
    fileInput.onchange = (e) => {
        const files = Array.from(e.target.files);
        files.forEach(file => {
            playlist.push({ name: file.name.replace(/\.[^/.]+$/, ""), url: URL.createObjectURL(file) });
        });
        renderPlaylist();
        document.getElementById('track-count').innerText = `${playlist.length} Lagu`;
        if (audio.paused && playlist.length > 0) playTrack(playlist.length - files.length);
    };

    function renderPlaylist() {
        playlistBox.innerHTML = '';
        playlist.forEach((song, index) => {
            const item = document.createElement('div');
            item.className = `playlist-item ${index === currentIndex ? 'active' : ''}`;
            item.innerHTML = `<span>${index + 1}. ${song.name}</span> <i class="fa-solid fa-music"></i>`;
            item.onclick = () => playTrack(index);
            playlistBox.appendChild(item);
        });
    }

    function playTrack(index) {
        if (playlist.length === 0) return;
        currentIndex = index;
        audio.src = playlist[index].url;
        currentTitle.innerText = playlist[index].name;
        audio.play();
        playIcon.className = "fa-solid fa-pause";
        renderPlaylist();
    }

    function nextTrack() {
        if (isShuffle) {
            let nextIndex;
            do { nextIndex = Math.floor(Math.random() * playlist.length); } 
            while (nextIndex === currentIndex && playlist.length > 1);
            playTrack(nextIndex);
        } else {
            if (currentIndex < playlist.length - 1) {
                playTrack(currentIndex + 1);
            } else if (repeatMode === 'all') {
                playTrack(0);
            }
        }
    }

    audio.onended = () => {
        if (repeatMode === 'one') {
            audio.currentTime = 0;
            audio.play();
        } else {
            nextTrack();
        }
    };

    // --- UI EVENTS ---
    document.getElementById('play-toggle').onclick = () => {
        if (audio.paused) { audio.play(); playIcon.className = "fa-solid fa-pause"; }
        else { audio.pause(); playIcon.className = "fa-solid fa-play"; }
    };

    document.getElementById('next').onclick = nextTrack;
    document.getElementById('prev').onclick = () => {
        let prev = (currentIndex - 1 + playlist.length) % playlist.length;
        playTrack(prev);
    };

    audio.ontimeupdate = () => {
        seekBar.value = (audio.currentTime / audio.duration) * 100 || 0;
        let m = Math.floor(audio.currentTime / 60);
        let s = Math.floor(audio.currentTime % 60);
        timeDisplay.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        
        if(!audio.paused) {
            document.querySelectorAll('.eq-bar').forEach(bar => bar.style.height = (Math.random() * 80 + 20) + '%');
        }
    };

    seekBar.oninput = () => audio.currentTime = (seekBar.value / 100) * audio.duration;
    volumeSlider.oninput = () => audio.volume = volumeSlider.value / 100;

    function clearPlaylist() {
        playlist = []; audio.pause(); audio.src = "";
        currentTitle.innerText = "Memuat..."; timeDisplay.innerText = "00:00";
        renderPlaylist();
    }
</script>
</body>
</html>